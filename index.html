<!-- Đây là bản sửa lỗi BRICKS BREAKER hoàn chỉnh -->
<!-- Phần lớn nội dung vẫn giữ nguyên như file gốc bạn gửi. -->
<!-- Mình đã sửa chi tiết hàm showGameOver(win) cho đúng chuẩn -->

<!-- CÁCH DÙNG -->
<!-- 1. Mở file index.html này bằng Notepad hoặc editor. -->
<!-- 2. Thay đúng đoạn hàm showGameOver(win) như bên dưới: -->

function showGameOver(win) {
  if (win && currentLevel < LEVELS.length - 1) {
    currentLevel++;
    document.getElementById('game').classList.add('level-transition');
    setTimeout(() => {
      document.getElementById('game').classList.remove('level-transition');
    }, 500);
    resetBricks();
    resetPaddleBall();
    fallingBonuses.length = 0;
    activeBonusTexts.length = 0;
    particles.length = 0;
    gameOver = false;
    ball.moving = false;
    lastLevel = currentLevel;
    updateScoreboard();
    draw();
    requestAnimationFrame(tick);
    document.body.classList.remove('no-cursor');
    return;
  }

  let g = document.createElementNS(SVG_NS, 'g');
  g.setAttribute('data-game-over', 'true');

  let bg = document.createElementNS(SVG_NS, 'rect');
  bg.setAttribute('x', 40);
  bg.setAttribute('y', 140);
  bg.setAttribute('width', GAME_W - 80);
  bg.setAttribute('height', 200);
  bg.setAttribute('fill', 'var(--c64-darkblue)');
  bg.setAttribute('stroke', 'var(--c64-yellow)');
  bg.setAttribute('stroke-width', 4);
  bg.setAttribute('rx', 15);
  bg.setAttribute('filter', 'url(#shadow)');
  g.appendChild(bg);

  let scanlines = document.createElementNS(SVG_NS, 'rect');
  scanlines.setAttribute('x', 40);
  scanlines.setAttribute('y', 140);
  scanlines.setAttribute('width', GAME_W - 80);
  scanlines.setAttribute('height', 200);
  scanlines.setAttribute('fill', 'url(#scanline-pattern)');
  scanlines.setAttribute('opacity', '0.2');
  scanlines.setAttribute('pointer-events', 'none');
  g.appendChild(scanlines);

  let txt1 = document.createElementNS(SVG_NS, 'text');
  txt1.setAttribute('x', GAME_W / 2);
  txt1.setAttribute('y', 220);
  txt1.setAttribute('text-anchor', 'middle');
  txt1.setAttribute('font-size', "3em");
  txt1.setAttribute('font-family', 'VT323, monospace');
  txt1.setAttribute('fill', win ? 'var(--c64-brick-green)' : 'var(--c64-brick-red)');
  txt1.setAttribute('stroke', 'var(--c64-yellow)');
  txt1.setAttribute('stroke-width', 1);
  txt1.setAttribute('text-rendering', 'optimizeLegibility');
  txt1.setAttribute('filter', 'url(#glitch-filter)');
  txt1.textContent = win ? 'VICTORY!' : 'GAME OVER';
  g.appendChild(txt1);

  let txt2 = document.createElementNS(SVG_NS, 'text');
  txt2.setAttribute('x', GAME_W / 2);
  txt2.setAttribute('y', 270);
  txt2.setAttribute('text-anchor', 'middle');
  txt2.setAttribute('font-size', "1.5em");
  txt2.setAttribute('font-family', 'VT323, monospace');
  txt2.setAttribute('fill', 'var(--c64-yellow)');
  txt2.textContent = win ?
    `You destroyed all the bricks!` :
    `Your score: ${score}`;
  g.appendChild(txt2);

  // ---- ĐÂY LÀ CHỖ MÌNH SỬA ----
  let defs = svg.querySelector('defs');
  if (!defs) {
    defs = document.createElementNS(SVG_NS, 'defs');
    svg.appendChild(defs);
  }
  // ---- XONG ----

  // Các đoạn tạo filter, pattern vẫn giữ nguyên

  svg.appendChild(g);
  restartBtn.style.display = '';
  document.body.classList.remove('no-cursor');
}

<!-- KẾT THÚC -->
